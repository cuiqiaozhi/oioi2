"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.assert = void 0;
//@ts-nocheck
let event;
function _exec(o, op = "and", field) {
    if (["and", "not", "or"].includes(op)) {
        if (Array.isArray(o)) {
            for (let rule of o) {
                let matched = _exec(rule, "and", field);
                if (!matched && op === "and")
                    return false;
                if (matched && op === "not")
                    return false;
                if (matched && op === "or")
                    return true;
            }
            return op !== "or" || !o.length;
        }
        else if (typeof o === "object" && o !== null) {
            for (let k in o) {
                let matched;
                if (k.startsWith("."))
                    matched = _exec(o[k], k.substr(1), field);
                else
                    matched = _exec(o[k], "eq", k);
                if (!matched && op === "and")
                    return false;
                if (matched && op === "not")
                    return false;
                if (matched && op === "or")
                    return true;
            }
            return op !== "or" || !Object.keys(o).length;
        }
        else {
            return false;
        }
    }
    if (typeof o === "object" && o !== null && !Array.isArray(o))
        return _exec(o, "and", field);
    if (op === "eq") {
        return o === event[field];
    }
    if (op === "neq") {
        return o !== event[field];
    }
    if (op === "in") {
        return o.includes(event[field]);
    }
    if (op === "contains") {
        return event[field].includes(o);
    }
    if (op === "regex") {
        if (o.startsWith("/"))
            o = o.substr(1);
        const split = o.split("/");
        const regex = new RegExp(split[0], split[1]);
        return !!event[field].match(regex);
    }
    return true;
}
function assert(filter, e) {
    if (!filter)
        return true;
    event = e;
    try {
        return _exec(filter);
    }
    catch {
        return false;
    }
}
exports.assert = assert;
